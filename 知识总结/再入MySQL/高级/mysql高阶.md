# 字符集相关操作

- 8之前默认字符集是latin1,utf8字符集指向的是utf8mb3。开发人员在数据库设计时往往需要讲字符集改为utf8(保证数据库，应用前端展示的字符集一致性，避免乱码)。8后，数据库默认编码将改为utf8mb64

- 

  ```tex
   //mysql客户端展示字符集
   character_set_client     | utf8      
   //连接传送数据的字符集
   character_set_connection | utf8                        //数据库字符集存储编码                                 
   character_set_database   | utf8                         //文件系统编码                                 
   character_set_filesystem | binary                       //查询结果编码                                
   character_set_results    | utf8                         //服务器端                                
   character_set_server     | utf8                         //系统字符集                                 
   character_set_system     | utf8
  ```


- 修改字符集

  - 编辑mysql.cnf

    - 
      
      ```cnf
      [mysqld]
      # 添加要修改的字符集配置
      character_set_server=utf8
      ```
      
      
  
  - 然后重启mysql服务，使得配置文件生效
  
  - 影响新创建数据库的字符集
  
- 修改表的字符集

  - alter  table 表名 convert tocharacter set 'utf-8';//修改字符集
  - show create table 表明；//展示表信息 

## 字符集的级别

- show variables like '%character%';

- 服务器级别
- 数据库级别
- 表级别
- 列级别
- 一次向下如果没有进行指定默认使用上级别的字符集。

## 字符集比较规则

- utf8与utf8mb4
  - utf8字符集标识一个字符需要使用1-4个字节，但是我们常用的一些字符使用1-3个字节就可以表示，而字符集表示一个字符所用的最大字节长度，在某些方面会影响系统的存储和性能，所以设计mysql的设计者偷偷的定义了两个概念
    - utf8mb3:阉割过的utf8字符集，只使用1-3个字节表示字符
    - utf8mb4:正宗utf8字符集，使用1-4分字节表示
- 在mysql中utf8时utf8mb3的别名，所以之后再mysql中提到utf8就意味着使用1-3个字节来表示一个字符。如果大家有使用4字节编码一个字符的情况，比如存储一些emoji表情，可以使用后者。
- 比较规则
  - ![](img\20220307140831.jpg)

- show collation like "gbk%";//查看gbk字符集比较规则

## 请求与响应的编码与解码过程

- ![](img\20220307141707.jpg)
- ![](img\20220307142143.jpg)

- 总结下就是：result和client要保持客户端传输数据的编码格式一致，这样双方才能准确还原数据。connection的编码和数据库数据存储编码应该一致，这样才能将数据与存储中的数据进行准确的映射。
- 实际开发全使用utf8
  - set names utf8

# Mysql索引

- [b 树查找时间复杂度_【142期】阿里面试：分析为什么B+树更适合作为索引的结构以及索引原理..._赵泠的博客-CSDN博客](https://blog.csdn.net/weixin_26843605/article/details/112125184)

- [B+ Tree、LSM、Fractal tree index比较_StarJava_的博客-CSDN博客](https://blog.csdn.net/qq_35425070/article/details/84320419)

- 什么是索引？

  - **索引**（在mysql中也叫做**键**）是存储引擎用于快速找到记录的一种**数据结构**

  - 索引存储在文件系统中

  - 索引优化应该是对查询性能优化最有效的手段。创建一个真正最优的索引经常需要重写查询

  - 理解索引：索引就是类似查询书籍或者是查询字典的方法，无非是先查询目录缩小查询范围，或者是准确定位。

  - MySQL中，存储引擎用类似的方法使用索引，其先在索引中找到对应值，然后根据匹配的索引记录找到对应的数据行。

    - **将``特定的列``按照一定的结构组织起来。当你需要的根据这个`列`来查找其对应的完整数据时，就按照这个组织结构进行查找，只要找到这个``具体列值``就能映射到完整的数据，而不是遍历所有的数据表进行查找，``所以查找数据的效率最终取决于这个组织结构的查找规则的效率``**

      ```sql
      select name from user where user.id=4
      #如果有将id建立索引，那么存储引擎会通过id索引进行查找id为4的行（因为我们这里还没有讲索引具体的组织方式，innodb用的是B+树），然后将其数据行返回，最后映射name列进行返回
      ```

      

  - > **索引可以包含一个或多个列的值，如果索引包含多个列，那么列的顺序也十分重要，**<font color="red">因为MySQL只能高效的使用索引的最左前缀列</font>。**创建一个包含两个列的索引，和创建来一个只包含一列的索引是大不相同的**

- >
  >
  >局部性原理：
  >
  >程序和数据的访问都有聚集成群的倾向，在一个时间段内，仅使用其中一小部分（**空间局部性**），或者最近访问过的程序代码和数据，很快又被访问的可能性很大（**时间局部性**）。
  >
  >故：有以下特征
  >
  >- 磁盘预读（**预读的长度一般为页的整数倍**）
  >  - 页是存储器的逻辑块，操作系统往往将主存和磁盘存储区分割为连续的大小相等的块，每个存储块称为一页（许多操作中，页的大小通常为4K）.主存和磁盘以页为单位交换数据。
  >  - 就是页的是存储器的最小存储单位
  >- [3层b+树索引访问磁盘次数_基于磁盘IO角度来看二叉树、Btree树、B+树_weixin_39851872的博客-CSDN博客](https://blog.csdn.net/weixin_39851872/article/details/111254713)

## 索引的类型

- 索引类型（组织形式）有很多种，在不同的场景中提供更好的性能。索引的实现是在存储引擎层而不是服务器层。所以，**并没有统一的索引标准，:不同的存储引擎的索引的工作方式并不一样，也不是所有的存储引擎都支持所有类型的索引，即使多个存储引擎支持同一种类型的索引，其底层的实现也可能不同（就和几个人写算法题一样，有的会有的不会，一题多解等等）**

- 常用于索引文件的数据结构：

  - hash
    - hash冲突：拉链模式（数组+链表）+红黑树
    - 直接映射查询O(1)确实很快
    - 使用hash存储需要将所有的数据文件添加到内存，比较耗费内存空间
      - **就是说因为是直接映射，所以数据文件必须全部读取然后进行映射**
    - 然后如果文件过大，内存也会溢出
    - 如果所有的查询都是等职查询，那么hash却似乎很快，但是在企业或者实际工作环境中**范围查找的数据更多**，而不是等值查询，因此hash就不太合适
  - 二叉树
    - 二叉树采用二分查找，正好满足范围查找的需求
    - 无论是二叉树还是红黑树，都会因为树的深度过深而造成IO次数变多，影响数据读取的效率
      - **当数据增加，索引也会增加，那么索引文件不能全部**
  - B树
    - 多路查找树
  - B+树
    - 在B树的基础上进行改进，非叶子节点只存储关键字不存值，叶子节点必须要存储所有的所有索引，且存储值。

- >
  >
  >要提升查询效率：因为硬件层面无法解决，那么只能减少IO次数，和减少IO的数据量

### B-Tree索引

- B树索引，人们普遍说的索引都是B树索引（没有一个东西叫做B-树，没有b减树）。

- 这种索引，很多存储引擎使用的是B+树进行实现。

- 这种索引只有Archive引擎不支持

  









- 如何知道该不该建立索引？
  - 通过执行计划









# 积累

- [分库分表你要怎么分_叮当的猫猫的博客-CSDN博客_分库分表](https://blog.csdn.net/qq_40813329/article/details/121405366)
- [分布式数据库sort那些事儿 - _雨 - 博客园 (cnblogs.com)](https://www.cnblogs.com/shangyu/p/6258969.html)
- [mysql 常用命令手册 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/259994094)
- [mysql 远程连接数据库的二种方法 - wq9 - 博客园 (cnblogs.com)](https://www.cnblogs.com/wq-9/articles/11062770.html)

